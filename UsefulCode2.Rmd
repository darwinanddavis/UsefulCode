---
title: Useful R code 2
author: |
 | Matthew Malishev^1^*
 |  
 | _^1^ Department of Biology, Emory University, 1510 Clifton Road NE, Atlanta, GA, USA, 30322_
#bibliography:/Users/malishev/Documents/Melbourne Uni/Thesis_2016/library.bib
fontsize: 10
geometry: margin=1in
documentclass: article
linkcolor: pink
urlcolor: blue
citecolor: red
always_allow_html: yes
output:
  html_document:
    highlight: tango
    code_folding: hide
    toc: yes
    toc_depth: 4
    number_sections: no
    toc_float: yes
  md_document: 
    variant: markdown_github
  pdf_document:
    includes:
      in_header: # add .tex file with header content
    highlight: tango
    template: null
    toc: yes
    toc_depth: 4
    number_sections: false
    fig_width: 4
    fig_height: 5
    fig_caption: true
    df_print: tibble 
    citation_package: biblatex # natbib
    latex_engine: xelatex #pdflatex # lualatex
    keep_tex: true # keep .tex file in dir 
  word_document:
    highlight: tango
    keep_md: yes
    pandoc_args: --smart
    #reference: mystyles.docx
    toc: yes
    toc_depth: 4
inludes:
  before_body: before_body.tex
subtitle: 
tags:
- nothing
- nothingness
params: 
  dir: "/Users/malishev/Documents/Melbourne Uni/Programs/R code/UsefulCode"
  date: !r Sys.Date()
  version: !r getRversion()
  email: "matthew.malishev@gmail.com"
  doi: https://github.com/darwinanddavis/UsefulCode
classoption: portrait
# ^['https://github.com/darwinanddavis/UsefulCode'] # footnote
vignette: >
  %\VignetteIndexEntry{Useful R code}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "all"} } });
</script>

```{r echo = FALSE}
 library(rmarkdown)
# setwd("")
# f <- list.files()[1]
# render(f, output_format='pdf_document')
# render(f, output_format='pdf_document')
```

```{r, set-options, echo = FALSE, cache = FALSE}
options(width=100)
knitr::opts_chunk$set(
 eval = F, # run all code
 # echo = FALSE, # show code chunks in output 
 comment = "",
 tidy.opts=list(width.cutoff=100), # set width of code chunks in output
 tidy=TRUE, # make output as tidy
 message = FALSE,  # mask all messages
 warning = FALSE, # mask all warnings 
 size="small" # set code chunk size
)

# https://github.com/ucb-stat133/stat133-fall-2016/blob/master/hws/hw02-tables-ggplot.Rmd
knitr::opts_knit$set(root.dir=paste0(params$dir,"/")) # set working dir

setwd(paste0(params$dir,"/")) # for running just in R not knitr
```

\  

Date: `r params$date`  
`R` version: `r params$version`  
*Corresponding author: `r params$email`  
This document can be found at `r params$doi`

\newpage  

## Overview

Same deal as Useful Code, but the second instalment because the first one has too much stuff in it and now runs slow.   

### Colour palettes
`Colorspace`  
```{r, col1, eval=T}
require(colorspace)
hcl_palettes(plot = TRUE) # show all palettes
```

```{r, col1_}
# https://cran.r-project.org/web/packages/colorspace/vignettes/colorspace.html
q4 <- qualitative_hcl(4, palette = "Dark 3") # discrete
s9 <- sequential_hcl(9, "Purples 3") # continuous
# for ggplot
scale_color_discrete_sequential(palette = "Purples 3", nmax = 6, order = 2:6)

```
      
Neon colour palettes      
```{r, col2,eval=T}
# https://www.shutterstock.com/blog/neon-color-palettes
neon1 <-  c("#3B27BA","#FF61BE","#13CA91","#FF9472")
neon2 <- c("#FFDEF3","#FF61BE","#3B55CE","#35212A")
neon3 <- c("#FEA0FE","#F85125","#02B8A2","#535EEB")
neon4 <- c("#535EEB","#001437","#C6BDEA","#FFAA01")
scales::show_col(c(neon1,neon2,neon3,neon4))
```
    
    
### D3    
D3 and leaflet  
```{r, d31, eval=T}
devtools::install_github("jcheng5/d3scatter")
library(d3scatter)
library(crosstalk)
library(leaflet)
library(tibble)

sd <- SharedData$new(quakes[sample(nrow(quakes), 100),])

bscols(widths = c(12, 6, 6),
       filter_slider("stations", "Stations", sd, ~stations),
       leaflet(sd, width = "100%", height = 400) %>% 
         addTiles() %>% 
         addCircleMarkers(lng=sd$data()[,"long"],
                    lat=sd$data()[,"lat"],
                    stroke = F,
                    fill = T,
                    color = "red",
                    fillOpacity = 0.5,
                    radius = ~mag + 2,
                    label = ~paste0("Depth: ",as.character(depth))
                    ),
       d3scatter(sd, width = "100%", height = 400, ~mag, ~depth, color = ~stations)
)

```


### Loading packages 
`pacman`  
```{r,load1}
require(pacman)
p_load(dplyr,mapdeck)

```


### Read in data    
Read in csv data sources directly from web  
``` {r, read1, results='hide',eval=F}
# link to raw csv link on e.g. github
url <- 'https://raw.githubusercontent.com/plotly/datasets/master/2011_february_aa_flight_paths.csv'
flights <- read.csv(url)  
```

### `Rmarkdown`  

<!-- ———————————————————————————————————————————————————————————————————————————— -->
***  
Split page into three columns (displays best in browser).  
_`R` code is in Rmd file._    

<!-- #https://holtzy.github.io/Pimp-my-rmd/ -->
<div class = "row">

<div class = "col-md-4">
```{r, rmarkdown1, message=F, echo=T, eval=T}
# r plot code
require(ggplot2)
ggplot(mtcars, aes(x=mpg)) + 
  geom_histogram(fill="skyblue", alpha=0.5) + 
  theme_classic()
```
</div>
  
<div class = "col-md-4">
<br><br>  

>Praise the lord, I was born to travel  
>Feeling like Slash in front of the chapel  
>I'm leaned back with the Les Paul  
>Shit I smoke is like cholesterol  
>Spilled dressin' on the vest at the festival  
>The best of all, had a midget Puerto Rican at my beckon call

</div>
  
<div class = "col-md-4">
<br><br>
Pump the bass in the trunk  
It rattled like a baby hand  
Except this toy cost 80 grand  
And I'm crazy tan, from all the places that I've been  
Just from writing words with a pen  

</div>
<!-- close div -->
</div> 

***
<!-- ———————————————————————————————————————————————————————————————————————————— -->

# `plotly`   

HTML widget with plotly and crosstalk
```{r, plotly1, eval=T, echo=T}
require(plotly)
require(tidyr)
require(crosstalk)

m <- gather(mpg, variable, value, -c(year,cyl))
msd <- highlight_key(m, ~variable)
gg <- ggplot(m, aes(factor(year), value)) + 
  geom_jitter(alpha = 0.3) +
  labs(x = "Year") +
  theme_classic()

bscols(
  widths = c(11, rep(5,2)),
  filter_select("id", "Select a variable", msd, ~variable, multiple = F),
  ggplotly(gg, dynamicTicks = "y") %>% 
    layout(margin = list(l = 30)),
  plot_ly(msd, x = ~jitter(cyl), y = ~value, alpha = ~cyl, linetype = NULL,
          mode = "markers",
          hoverinfo = "text", 
          text = ~paste0("Cyl: ", round(cyl),
                        "\n",variable,": ", value,
                        "\nYear: ", year)
          ) %>% 
    add_markers(alpha = 0.3) %>%
    layout(xaxis = list(showgrid = F,
                        title = "Cylinder"),
           yaxis = list(showgrid = F)
    )
)
```



